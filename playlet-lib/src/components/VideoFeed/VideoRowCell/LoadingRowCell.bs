import "pkg:/source/utils/Types.bs"

function Init()
    ' TODO:P0 use component property with alias to fix crash
    ' TODO:P2 make component disposable, and stop animation when component is disposed
    m.animation = m.top.findNode("loadingAnimation")
    m.top.observeField("visible", FuncName(OnVisibleChanged))
    OnVisibleChanged()
end function

function OnVisibleChanged()
    Animate()
end function

function OnIndexSet()
    m.animation.delay = (m.top.index mod 5) * 0.2
    Animate()
end function

function Animate()
    m.animation.control = m.top.visible ? "start" : "stop"
end function
